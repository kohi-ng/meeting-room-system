<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Meeting Room Booking (Demo)</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; margin:0; padding:0; }
    header { background:#2c3e50; color:#fff; padding:12px 20px; }
    .container { padding:20px; }
    .grid { display:flex; gap:12px; flex-wrap:wrap; }
    .card { border:1px solid #ddd; padding:12px; width:220px; border-radius:6px; }
    .btn { background:#1976d2; color:#fff; padding:8px 12px; border:none; cursor:pointer; border-radius:4px }
    .modal { position:fixed; inset:0; background:rgba(0,0,0,0.4); display:flex; align-items:center; justify-content:center }
    .modal .panel { background:#fff; padding:18px; width:480px; border-radius:6px }
    input, select, textarea { width:100%; padding:8px; margin:6px 0; box-sizing:border-box }
    .calendar { border:1px solid #eee; padding:10px; margin-top:20px }
  </style>
</head>
<body>
  <header>
    <h1>Meeting Room Booking (Demo)</h1>
  </header>
  <div class="container">
    <div id="auth">
      <h3>Login / Register (demo)</h3>
      <input id="email" placeholder="Email">
      <input id="password" placeholder="Password" type="password">
      <div style="margin-top:8px">
        <button class="btn" id="btnLogin">Login</button>
        <button class="btn" id="btnRegister">Register</button>
      </div>
      <hr>
    </div>

    <div id="main" style="display:none">
      <div style="display:flex; justify-content:space-between; align-items:center">
        <div>
          <strong id="userEmail"></strong>
        </div>
        <div>
          <button class="btn" id="btnLogout">Logout</button>
        </div>
      </div>

      <h3>Rooms</h3>
      <div style="margin-bottom:8px">
        <input id="filter" placeholder="Filter by feature or name">
        <button class="btn" id="btnFilter">Filter</button>
        <button class="btn" id="btnReset">Reset</button>
      </div>
      <div id="rooms" class="grid"></div>

      <div class="calendar">
        <h4>Simple Calendar Grid (Demo)</h4>
        <div id="calendarGrid">Click a room's "Book" to open booking form.</div>
      </div>
    </div>
  </div>

  <div id="modal" style="display:none" class="modal">
    <div class="panel">
      <h3 id="modalTitle">Book Room</h3>
      <input id="meetingTitle" placeholder="Meeting title">
      <textarea id="meetingAgenda" placeholder="Agenda / notes"></textarea>
      <label>Start</label>
      <input id="startTime" type="datetime-local">
      <label>End</label>
      <input id="endTime" type="datetime-local">
      <label>Attach document (URL)</label>
      <input id="docUrl" placeholder="https://drive.google.com/...">
      <div style="margin-top:8px; display:flex; gap:8px">
        <button class="btn" id="btnSave">Save</button>
        <button class="btn" id="btnCancel">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    let rooms = [];
    let selectedRoom = null;
    let token = localStorage.getItem('mrs_token');

    async function api(path, opts={}){
      const headers = opts.headers||{};
      if(token) headers['Authorization'] = 'Bearer '+token;
      const res = await fetch('/api'+path, { headers, ...opts });
      return res.json();
    }

    async function loadRooms(){
      const data = await api('/rooms');
      rooms = data;
      renderRooms(rooms);
    }

    function renderRooms(list){
      const el = document.getElementById('rooms'); el.innerHTML='';
      list.forEach(r=>{
        const div = document.createElement('div'); div.className='card';
        div.innerHTML = `<strong>${r.name}</strong><div>Capacity: ${r.capacity}</div><div>Features: ${r.features.join(', ')}</div><div style="margin-top:8px"><button class='btn' data-id='${r.id}'>Book</button></div>`;
        el.appendChild(div);
      });
      document.querySelectorAll('#rooms .btn').forEach(b=>b.addEventListener('click', (e)=>{
        const id = e.target.dataset.id; openBooking(id);
      }));
    }

    function openBooking(id){
      selectedRoom = rooms.find(r=>r.id==id);
      document.getElementById('modalTitle').innerText = 'Book '+selectedRoom.name;
      document.getElementById('modal').style.display='flex';
    }

    document.getElementById('btnCancel').addEventListener('click', ()=>document.getElementById('modal').style.display='none');
    document.getElementById('btnSave').addEventListener('click', async ()=>{
      const meeting = {
        roomId: selectedRoom.id,
        title: document.getElementById('meetingTitle').value,
        agenda: document.getElementById('meetingAgenda').value,
        startTime: document.getElementById('startTime').value,
        endTime: document.getElementById('endTime').value,
        docUrl: document.getElementById('docUrl').value
      };
      const res = await api('/meetings', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(meeting)});
      alert(res.message || 'Saved');
      document.getElementById('modal').style.display='none';
    });

    // auth
    document.getElementById('btnLogin').addEventListener('click', async ()=>{
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const res = await fetch('/api/login', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email,password}) });
      const j = await res.json();
      if(j.token){ token = j.token; localStorage.setItem('mrs_token', token); showMain(email); loadRooms(); } else alert(j.message||'Login failed');
    });
    document.getElementById('btnRegister').addEventListener('click', async ()=>{
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const res = await fetch('/api/register', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({email,password}) });
      const j = await res.json();
      alert(j.message||'Registered');
    });
    document.getElementById('btnLogout').addEventListener('click', ()=>{ localStorage.removeItem('mrs_token'); token=null; location.reload(); });

    document.getElementById('btnFilter').addEventListener('click', ()=>{
      const q = document.getElementById('filter').value.toLowerCase();
      const filtered = rooms.filter(r => r.name.toLowerCase().includes(q) || r.features.join(' ').toLowerCase().includes(q));
      renderRooms(filtered);
    });
    document.getElementById('btnReset').addEventListener('click', ()=>renderRooms(rooms));

    function showMain(email){
      document.getElementById('auth').style.display='none';
      document.getElementById('main').style.display='block';
      document.getElementById('userEmail').innerText = email;
    }

    if(token){ // try to show main
      document.getElementById('auth').style.display='none';
      document.getElementById('main').style.display='block';
      document.getElementById('userEmail').innerText = 'You (authed)';
      loadRooms();
    }

  </script>
</body>
</html>